/*! 2016 Baidu Inc. All Rights Reserved */
define("comm",["require"],function(require){var exports={};return exports.fetch=function(e,t,i){var n={type:"GET",dataType:"json",contentType:"application/json",cache:!1,timeout:5e3};return t=t||{},i=i||{},i=$.extend({url:e,data:t},n,i),$.ajax(i)},exports.post=function(e,t,i){return i=i||{},$.extend(i,{type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8"}),this.fetch(e,t,i)},exports.ajaxPost=function(e,t,i){return i=i||{},$.extend(i,{type:"POST"}),this.fetch(e,$.stringifyJSON(t),i)},exports.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);if(null!=i)return encodeURIComponent(i[2]);else return null},exports.gernerateTime=function(e){var t={};if(e>0){t.day=Math.floor(e/86400);var i=86400*t.day,n="00"+Math.floor((e-i)/3600);t.hour=n.substring(n.length-2);var r=3600*t.hour;n="00"+Math.floor((e-i-r)/60),t.min=n.substring(n.length-2),n="00"+(e-i-r-60*t.min),t.sec=n.substring(n.length-2)}else t.day=0,t.hour=0,t.min=0,t.sec=0;return t},exports.countDown=function(e){var t,i=Math.round((new Date).getTime()/1e3),n=0;if(arguments.length>1)t=i-n-arguments[1];else t=e-i-n;return exports.gernerateTime(t)},exports.timeInterval=function(e,t){t=Math.round((t||(new Date).getTime())/1e3);var i=e-t;return exports.gernerateTime(i)},exports.notEmpty=function(e,t){function i(e,t){var n=t.length,r=t.shift();if(e[r])if(1===n)return!0;else return i(e[r],t);return!1}if("string"!=typeof t||!e instanceof Object)return!1;var n=t.split(".");return i(e,n)},exports.locationJump=function(e,t){var i=this,n=i.getUrlParam("tg"),r=e,o="tr=cp."+pageId+"_pr."+cr+(t?"_po."+t:"");if(n&&e.indexOf("tg=")<0)if(~r.indexOf("?"))r=r+"&tg="+n;else r=r+"?tg="+n;try{if(~e.indexOf("tr="))r=r.replace(/tr=\d+/,o);else if(~r.indexOf("?"))r=r+"&"+o;else r=r+"?"+o}catch(s){}return r},exports.replaceEnter=function(e){if("string"==typeof e)return e.replace(/((\r\n\s*)|\n\s*|\r\s*)+/g,"<br>");else return e},exports.inherit=function(e,t,i){function n(){}var r=e.prototype;n.prototype=r;var o=function(){e.apply(this,arguments)};return o.prototype=new n,$.extend(o.prototype,t),$.extend(o,e,i),o.prototype.constructor=o,o},exports}),define("../tpl/cartPreview.tpl",[],function(){return'<div class="bag-inner">\n	{{ if : ${skus.length} }}\n	<div class="bag-content">\n		<div class="bag-lists">\n			<ul>\n				{{ for : ${skus}  as ${item},${index} }}\n				{{ var : skuInfo = ${item.skuInfo} }}\n				<li class="list" data-id="${skuInfo.skuId}" data-shopid="${skuInfo.shopId}" data-num="${item.skuNum}" data-max="${skuInfo.max}" data-type=${skuInfo.skuType} data-status=${item.status} data-limit=${skuInfo.salesRestriction} data-price="${skuInfo.nowPrice}">\n					<dl class="price-wrap">\n						<dd><span class="price-num">¥ ${skuInfo.nowPrice}x${item.skuNum}</span><a href="javascript:;" class="del-btn">×</a></dd>\n						<dt class="clearfix">\n							<div class="num-form {{ if: ${item.status} == 4 }} sell-out {{/if}}">\n								<a href="javascript:;" class="decrement {{ if: ${item.status} == 4 || ${item.skuNum} <=1 }}disabled{{/if}}">-</a>\n								<input type="text" value="${item.skuNum}" class="num" autocomplete="off">\n								<a href="javascript:;" class="increment {{ if: ${item.status} == 1 || ${item.skuNum} >= ${skuInfo.max} }}disabled{{/if}}">+</a>\n							</div>\n						</dt>\n					</dl>\n					<dl class="goods-wrap">\n						<dt><a href="/product?itemId=${skuInfo.itemId}&skuId=${skuInfo.skuId}" target="_blank"><img src="{{ if: ${skuInfo.skuImageUrl} }}${skuInfo.skuImageUrl}{{ else }}http://mallcdn.baidu.com/img/widget/img_loading_98_98.png{{ /if }}"></a></dt>\n						<dd>\n							<p class="desc"><a href="/product?itemId=${skuInfo.itemId}&skuId=${skuInfo.skuId}" target="_blank">${skuInfo.skuName}</a></p>\n							<p class="info">{{ for : ${skuInfo.skuProperties} as ${property},${index} }}<span class="color-info"><i>${index}：</i>${property}</span>{{ /for }}</p>\n						</dd>\n					</dl>\n				</li>\n			{{ /for }}\n			</ul>\n		</div>\n		<div class="bag-total">\n			共<span class="num"> ${totalNum} </span>件商品，总计 <span class="total-price">¥ ${totalPrice}</span><a href="/cart/list" class="cart-btn" data-position-id="1000006">去购物袋结算</a>\n		</div>\n	</div>\n	{{ elif : ${errorStatus} }}\n	<div class="bag-empty">\n		请稍候再试～～\n	</div>\n	{{ else }}\n	<div class="bag-empty">\n		{{ if : ${invalidSkus.length} }}您购物袋里的宝贝均已失效{{ else }}购物袋瘪瘪的{{ /if }}，快去<a href="/">采购</a>吧~\n	</div>\n	{{ /if }}\n</div>\n'}),function(e){function t(e){var t=v[e]={};return u(e.split(/\s+/),function(e){t[e]=!0}),t}var i={},n=Array.prototype,r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=n.forEach,l=n.indexOf,c=n.slice,u=function(e,t,n){var r,s,l;if(e)if(a&&e.forEach===a)e.forEach(t,n);else if(e.length===+e.length){for(s=0,l=e.length;l>s;s++)if(s in e&&t.call(n,e[s],s,e)===i)return}else for(r in e)if(o.call(e,r))if(t.call(n,e[r],r,e)===i)return},d=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},h=function(e){return u(c.call(arguments,1),function(t){var i;for(i in t)if(void 0!==t[i])e[i]=t[i]}),e},f=function(e,t,i){var n;if(t){if(l)return l.call(t,e,i);for(n=t.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in t&&t[i]===e)return i}return-1},p={};u("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){p["[object "+e+"]"]=e.toLowerCase()});var m=function(e){return null==e?String(e):p[s.call(e)]||"object"},g={},v={};if(g.Callbacks=function(e){e="string"==typeof e?v[e]||t(e):h({},e);var i,n,r,o,s,a,l=[],c=!e.once&&[],d=function(t){for(i=e.memory&&t,n=!0,a=o||0,o=0,s=l.length,r=!0;l&&s>a;a++)if(l[a].apply(t[0],t[1])===!1&&e.stopOnFalse){i=!1;break}if(r=!1,l)if(c){if(c.length)d(c.shift())}else if(i)l=[];else p.disable()},p={add:function(){if(l){var t=l.length;if(function n(t){u(t,function(t){var i=m(t);if("function"===i){if(!e.unique||!p.has(t))l.push(t)}else if(t&&t.length&&"string"!==i)n(t)})}(arguments),r)s=l.length;else if(i)o=t,d(i)}return this},remove:function(){if(l)u(arguments,function(e){for(var t;(t=f(e,l,t))>-1;)if(l.splice(t,1),r){if(s>=t)s--;if(a>=t)a--}});return this},has:function(e){return f(e,l)>-1},empty:function(){return l=[],this},disable:function(){return l=c=i=void 0,this},disabled:function(){return!l},lock:function(){if(c=void 0,!i)p.disable();return this},locked:function(){return!c},fireWith:function(e,t){if(t=t||[],t=[e,t.slice?t.slice():t],l&&(!n||c))if(r)c.push(t);else d(t);return this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!n}};return p},g.Deferred=function(e){var t=[["resolve","done",g.Callbacks("once memory"),"resolved"],["reject","fail",g.Callbacks("once memory"),"rejected"],["notify","progress",g.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return g.Deferred(function(i){u(t,function(t,n){var o=t[0],s=e[n];r[t[1]](d(s)?function(){var e;try{e=s.apply(this,arguments)}catch(t){return void i.reject(t)}if(e&&d(e.promise))e.promise().done(i.resolve).fail(i.reject).progress(i.notify);else i["notify"!==o?"resolveWith":o+"With"](this===r?i:this,[e])}:i[o])}),e=null}).promise()},promise:function(e){return null!=e?h(e,n):n}},r={};if(n.pipe=n.then,u(t,function(e,o){var s=e[2],a=e[3];if(n[e[1]]=s.add,a)s.add(function(){i=a},t[1^o][2].disable,t[2][2].lock);r[e[0]]=s.fire,r[e[0]+"With"]=s.fireWith}),n.promise(r),e)e.call(r,r);return r},g.when=function(e){var t,i,n,r=0,o="array"===m(e)&&1===arguments.length?e:c.call(arguments),s=o.length,a=1!==s||e&&d(e.promise)?s:0,l=1===a?e:g.Deferred(),u=function(e,i,n){return function(r){if(i[e]=this,n[e]=arguments.length>1?c.call(arguments):r,n===t)l.notifyWith(i,n);else if(!--a)l.resolveWith(i,n)}};if(s>1)for(t=new Array(s),i=new Array(s),n=new Array(s);s>r;r++)if(o[r]&&d(o[r].promise))o[r].promise().done(u(r,n,o)).fail(l.reject).progress(u(r,i,t));else--a;if(!a)l.resolveWith(n,o);return l.promise()},"undefined"!=typeof module&&module.exports)module.exports=g;else if(define&&define.amd)define("common/underscore.deferred",[],g);else if("undefined"!=typeof e._)e._.mixin(g);else e._=g}(this),!function(e){if("function"==typeof define&&define.amd)define("common/cookie",[],e);else if("object"==typeof exports)module.exports=e();else{var t=window.Cookies,i=window.Cookies=e(window.jQuery);i.noConflict=function(){return window.Cookies=t,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(i){function n(t,r,o){var s;if(arguments.length>1){if(o=e({path:"/"},n.defaults,o),"number"==typeof o.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*o.expires),o.expires=a}try{s=JSON.stringify(r),/^[\{\[]/.test(s)&&(r=s)}catch(l){}return r=encodeURIComponent(String(r)),r=r.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",r,o.expires&&"; expires="+o.expires.toUTCString(),o.path&&"; path="+o.path,o.domain&&"; domain="+o.domain,o.secure?"; secure":""].join("")}t||(s={});for(var c=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,d=0;d<c.length;d++){var h=c[d].split("="),f=h[0].replace(u,decodeURIComponent),p=h.slice(1).join("=");'"'===p.charAt(0)&&(p=p.slice(1,-1));try{if(p=i&&i(p,f)||p.replace(u,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(l){}if(t===f){s=p;break}t||(s[f]=p)}catch(l){}}return s}return n.get=n.set=n,n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,i){n(t,"",e(i,{expires:-1}))},n.withConverter=t,n}return t()}),define("common/passport",["require","./underscore.deferred","./cookie","../comm"],function(require){var e=require("./underscore.deferred"),t=require("./cookie"),i="http://"+location.host,n=location.href,r=GLOBAL_CONF.passport.tpl||"baidumall",o="http://"+GLOBAL_CONF.passport.host||"http://passport.baidu.com";passportConf={scriptLink:o+"/passApi/js/uni_login_wrapper.js?cdnversion=20150331",fillUserNameScriptLink:o+"/passApi/js/wrapper.js?cdnversion=20150506",fillUserNameCSSLink:o+"/passApi/html/css/fillUserName.css",staticPage:i+"/v3Jump.html",tpl:r,u:n,authsite:["qzone","tsina"],registerLink:o+"/v2/?reg&tpl="+r+"&u="+i,logoutLink:o+"/?logout&u="+n,settingLink:o};var s=null,a=require("../comm"),l={userInfo:null,init:function(){return a.fetch("/user/loginInfo").then(function(e){if(l.userInfo=null,e&&e.isLogin)l.userInfo={displayName:e.displayname},l.trigger("login",l.userInfo);else t.remove("mi");return l.userInfo}).fail(function(e){return t.remove("mi"),l.userInfo=null,e})},tryLogin:function(t){function i(){return s=s||window.passport.pop.init({apiOpt:{loginType:1,u:passportConf.u,safeFlag:0,staticPage:passportConf.staticPage,product:passportConf.tpl,memberPass:!0},cache:!1,authsite:passportConf.authsite,tangram:!0,registerLink:passportConf.registerLink,onLoginSuccess:function(e){s.hide(),e.returnValue=!1,l.userInfo={displayName:e.rsp.data.userName},r.resolve(l.userInfo),n.init()}}),s.show(),r}var n=this,r=new e.Deferred;if(this.userInfo&&!t)return r.resolve(this.userInfo);else return $.getScript(passportConf.scriptLink).then(i)},gotoRegisterPage:function(){window.open(passportConf.registerLink)},logout:function(){t.remove("mi"),t.remove("mi",{domain:".mall.baidu.com"}),t.remove("ms"),t.remove("ms",{domain:".mall.baidu.com"}),location.href="http://passport.baidu.com/?logout&u="+encodeURIComponent(location.href)},on:function(e,t,i){var n;if("function"!=typeof t||!e)return this;else return n=this._events||(this._events={}),n[e]=n[e]||[],n[e].push({context:i||this,callback:t}),this},trigger:function(e){var t,i=this._events;if(!i||!e||!i[e])return this;else return t=[].slice.call(arguments,1),$.each(i[e],function(e,i){i.callback.apply(i.context,t)}),this}};return l}),define("widget/feedback",["require"],function(require){function e(e,t,i){var n=document.createElement("script"),i=i||{};if(n.type="text/javascript",i.charset)n.charset=i.charset;if(i.id)n.id=i.id;if(n.readyState)n.onreadystatechange=function(){if("loaded"==n.readyState||"complete"==n.readyState)n.onreadystatechange=null,t()};else n.onload=function(){t()};n.src=e,document.body.appendChild(n)}!function(){function t(){if(bds&&bds.qa&&bds.qa.ShortCut&&bds.qa.ShortCut.initRightBar){var e={product_id:160,plugintitle:"问题和意见",issueTips:"对百度MALL不满意吗？请告诉我们",issuePlaceholder:"欢迎提出您再使用过程中遇到的问题或宝贵建议，感谢您对百度MALL的支持。",emailPlaceholder:"留下您的邮箱，便于我们及时回复您。",guide:"<span>有任何问题请联系baidumall@baidu.com</span><br>",cutFileTips:"上传问题图片，图片大小不超过3M",cutCanvasTips:"（点我，可以在当前页面标记问题哦）",emailTips:"联系方式（选填）",needIssueTips:"true",needIssue:"true",needCut:!1,needEmail:"true",needGuide:"false",showPosition:"center",onlyUpFile:!1,cutImg:"biaoji.png",upImg:"upload_btn.png",skinStyle:"flat"};bds.qa.ShortCut.initRightBar(e);var t={product_id:"160",username:"",query:"",version:"1.0"};bds.qa.ShortCut._getProData(t)}}function i(){if(window.bds&&window.bds.qa&&window.bds.qa.ShortCut)t();else e("http://f3.baidu.com/feedback/js/feedback/feedback0.0.2.js",function(){t()},{charset:"utf-8",id:"feedback_script"});return!1}$(document).on("click",".btn-feedback",i)}()}),define("plugins/plugins",[],function(){var e={};return e.dateformat=function(e,t){switch(t=t||"yyyy-MM-dd",typeof e){case"string":e=parseInt(e,10);case"number":e=new Date(e)}if(!e instanceof Date)e=new Date;var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};if(/(y+)/.test(t))t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length));for(var n in i)if(new RegExp("("+n+")").test(t))t=t.replace(RegExp.$1,1===RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length));return t},e.dealNum=function(e,t){if(e){if("string"==typeof e)e=parseInt(e,10);if(t)return parseFloat(e/100).toFixed(t);else{var i=0;if(e%10)i=2;else if(e%100)i=1;if(i)return parseFloat(e/100).toFixed(i);else return parseInt(e/100)}}},e.indexOf=function(e,t,i){if(e)if("string"==typeof e){var n=e.length>>>0,r=Number(i)||0;if(r=0>r?Math.ceil(r):Math.floor(r),0>r)r+=n;for(;n>r;r++)if(e[r]===t)return r;return-1}},e.js=function(e){return String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'"').replace(/\n/g,"\n").replace(/\r/g,"\r").replace(/<\//g,"<\\/")},e.json=function(e){return JSON.stringify(e)},e.mobileNumberEncrypt=function(e){if(!e||"string"!=typeof e)return e;var t=e.substring(0,3),i=e.substring(e.length-4);return t+"****"+i},e.nameEncrypt=function(e){if(!e||"0"===e)return"1*******"+Math.floor(9*Math.random());if(e.length<=2)return e;var t=e.match(/^.(.*).$/)[1],i=e.charAt(0);return i+=t.replace(/./g,function(){return"*"}),i+=e.substr(-1,1)},e.slice=function(e,t,i){if(e)if("string"==typeof e){var n=e.length>>>0,r=[],o=t||0;o=o>=0?o:Math.max(0,n+o),i="undefined"!=typeof i?i:n;var s="number"==typeof i?Math.min(i,n):n;if(0>i)s=n+i;if(size=s-o+1,size>0)for(var a=0;a<size;a++)r.push(e[o+a]);return r.join("")}},e.strReplace=function(e,t,i){var n=new RegExp(t,"g");return e.replace(n,i)},e.arrSlice=function(e,t,i){if("[object Array]"!==Object.prototype.toString.call(e))return e;else return[].slice.call(e,t,i)},e.substr=function(e,t,i){if("string"!=typeof e)return e;else return String.prototype.substr.apply(e,Array.prototype.slice.call(arguments,1))},e.omit=function(e,t){if("string"!=typeof e)return e;for(var i=e.length,t=t||i,n=0,r="",o=0;i>o;o++){if(r+=e[o],e.charCodeAt(o)>=1e4)n++;else n+=.66;if(n>=t&&o!=i-1)return r+="..."}return r},e.multiNum=function(e,t,i){var n=parseFloat(e),r=parseFloat(t),o=i?i:2,s=n*r;return s.toFixed(o)},e.msToDate=function(e,t){if(0>e)return 0;if(1===t){var i=parseInt(e%60);return i}if(2===t){var n=parseInt(e/60),r=n%60;return r}if(3===t){var o=parseInt(e/3600),s=o%24;return s}if(4===t){var a=parseInt(e/86400);return a}},e.dealOrders=function(e){if(e)if("string"==typeof e){var t,i=e.split(",");if(i.length>5)return t=i.slice(0,5),t.join(",")+"…";else return e}},e.toFixed=function(e,t){if("number"==typeof e&&e===e)return Number.prototype.toFixed.call(e,t);else if("string"==typeof e)return e=parseFloat(e),Number.prototype.toFixed.call(e,t);return e},e.toUpperCase=function(e){if("string"!=typeof e)return e;else return String.prototype.toUpperCase.apply(e)},e.replace=function(e){if("string"==typeof e)return String.prototype.replace.apply(e,[].slice.call(arguments,1));else return e},e.keepFen=function(e){if(e!=+e)return e;if(e=1*e,e===Math.floor(e))return"";else return String(e).substr(String(e).indexOf("."))},e.discount=function(e,t,i){return i=i||1,(t/e*10).toFixed(1)},e.toFixedWithoutDoubleZero=function(e,t){if(e=parseFloat(e),e===Math.floor(e))return e.toFixed(0);else return e.toFixed(t)},e.parseInt=function(e){return parseInt(e)},e.join=function(e){if(!(e instanceof Array))return e;else return[].join.apply(e,Array.prototype.slice.call(arguments,1))},e.imgOptimize=function(e,t){if("string"==typeof e&&e.indexOf("mallcms")>=0&&e.indexOf("@")<0){e=e.replace(/mallcmscdn/g,"mallcmspiccdn");var i,n=e.split(".").pop().split("?")[0].split("#")[0],r=n,o="@q_90,f_";switch(n){case"jpg":case"jpeg":case"bmp":if("string"==typeof t&&(i=t.match(/chrome\/([\d.]+)/i))&&parseInt(i[1],10)>=23)r="webp";case"png":case"webp":e+=o+r}}return e},e.jsonObjectParse=function(e){try{return JSON.parse(e)}catch(t){return{}}},e.jsonArrayParse=function(e){try{return JSON.parse(e)}catch(t){return[]}},e.split=function(e,t){try{return e.split(t)}catch(i){return[]}},e}),define("common/view",["require","./etpl","../plugins/plugins"],function(require){var e=require("./etpl"),t=require("../plugins/plugins");return{etpl:e,init:function(){e.config({commandOpen:"{{",commandClose:"}}",strip:!0});for(var i in t)if(t.hasOwnProperty(i))e.addFilter(i,t[i])}}}),define("widget/header",["require","../comm","../common/etpl","../../tpl/cartPreview.tpl","../common/passport","../common/cookie","./feedback","../common/view"],function(require){var e=require("../comm"),t=require("../common/etpl"),i=require("../../tpl/cartPreview.tpl"),n=require("../common/passport"),r=require("../common/cookie");require("./feedback");var o=require("../common/view");t.config({commandOpen:"{{",commandClose:"}}",strip:!0});var s={talkInfo:{},init:function(){o.init(),this.getMinUserInfo(".common-login-info"),this.getMinCartInfo(".mini-header-search .num"),this.bindMinHeader(),this.bindMenu(),this.bindTalk(),this.generateTongjiLinks(),this.bindSearchBox()},initMinHeader:function(){this.getMinUserInfo(".login-info"),this.getMinCartInfo(".mini-header .num"),this.bindMinHeader(),this.bindTalk(),this.generateTongjiLinks(),this.bindSearchBox()},bind:function(){var e=this;$("#header").on("mouseenter",".shopping-trolley",function(){$(this).addClass("hover")}).on("mouseenter",".amount",function(t){!$(t.relatedTarget).hasClass("list")&&!$(t.relatedTarget).hasClass("bag-empty")&&!$(t.relatedTarget).hasClass("loading-wrap")&&e.getCartInfo()}).on("mouseleave",".shopping-trolley",function(){$(this).removeClass("hover")}).on("mouseenter",".bag-wrap .list",function(){$(this).addClass("hover")}).on("mouseleave",".bag-wrap .list",function(){$(this).removeClass("hover")}),this.bindNumBtns(),$("#header").on("click",".del-btn",function(){var t=$(this).parents(".list");e.delCart($(this),t.attr("data-id"))})},showSearchResult:function(){var t=$(".search-text").val(),i="http://nssug.baidu.com/su?wd="+t+"&prod=mall&json=1&cb=?",n={dataType:"jsonp"},r=e.fetch(i,null,n);r.done(function(e){for(var t="",i=0;i<e.s.length;++i)t+="<li>"+e.s[i]+"</li>";if(""!==t)t+='<li class="search-suggest-close">关闭</li>',$(".search-suggest").html(t).show();else $(".search-suggest").hide()})},gotoSearchPage:function(t){var i=encodeURIComponent($.trim(t));if(""!==i){var n="/search?q="+i;location.href=e.locationJump(n)}},bindSearchKeyPress:function(e){var t=this,i=$(".search-suggest"),n=$(".search-suggest").children("li"),r=$(".search-text"),o=n.length-1,s=t.highlightIndex;if(38===e){if(-1!==s)n.eq(s).removeClass("highlight"),s-=1;else s=o-1;if(-1===s)s=o-1;t.highlightIndex=s,n.eq(s).addClass("highlight");var a=n.eq(s).text();r.val(a)}else if(40===e){if(-1!==s)n.eq(s).removeClass("highlight"),s+=1;else s=0;if(s===o)s=0;t.highlightIndex=s,n.eq(s).addClass("highlight");var a=n.eq(s).text();r.val(a)}else if(13===e){if(i.hide(),r.blur(),-1!==s)t.highlightIndex=-1;t.gotoSearchPage(r.val())}else if(27===e)if($(".search-suggest").is(":visible"))$(".search-suggest").hide()},bindNoticeInfo:function(){setInterval(this.scrollNotice,5e3)},scrollNotice:function(){$(".header-notice").animate({marginTop:"-34px"},500,function(){$(".header-notice").css({marginTop:"0px"}).find("li:first").appendTo(".header-notice")})},bindSearchBox:function(){var e=this;e.highlightIndex=-1;var t=$(".search-text"),i=$(".search-suggest"),n=$(".search-btn");t.on("keyup",function(t){var i=t||window.event,n=i.keyCode;if(38===n||40===n||13===n||27===n)if($(".search-suggest").is(":visible"))e.bindSearchKeyPress(n);else if(13===n)e.bindSearchKeyPress(n);else e.highlightIndex=-1;else e.highlightIndex=-1,e.showSearchResult()}),i.on("click","li",function(){if(!$(this).hasClass("search-suggest-close")){var i=$(this).text();t.val(i),e.gotoSearchPage(i)}}),n.on("click",function(){var i=t.val();e.gotoSearchPage(i)}),$(document).on("click",function(n){if(!$(n.target).hasClass("search-text"))i.hide();else{var r=t.val();if(""!==r)e.showSearchResult()}})},bindNumBtns:function(){var e=this;$(".bag-wrap").on("click",".decrement,.increment",function(){var t,i,n,r,o=$(this);if(r=o.hasClass("decrement")?1:0,t=o.parents(".list"),!t.hasClass("loading"))if(!o.parent(".num-form").hasClass("sell-out"))if(!o.hasClass("disabled"))i=t.find(".num"),n=i.val(),n=r?--n:++n,n=e.checkNum(n,t),e.updateCart(t,n)}),$(".bag-wrap").on("focus",".num",function(e){var t=parseInt($(this).val(),10);if(!isNaN(t))if(t)$(this).data("prevNum",t)}),$(".bag-wrap").on("blur",":not(.sell-out) .num",function(){var t=$(this).parents(".list"),i=$(this).val();if(t.hasClass("loading"))return void $(this).val($(this).data("prevNum"));if(!/^(\d)+$/.test(i))return void $(this).val($(this).data("prevNum"));if(i=parseInt(i,10),i=e.checkNum(i,t),$(this).data("prevNum")!==i)e.updateCart(t,i)}).on("keydown",".num",function(e){if(13===e.keyCode||27===e.keyCode)$(this).blur()}),$(".bag-wrap").on("focus",".sell-out .num",function(){$(this).blur()})},checkNum:function(e,t,i){var n=t.attr("data-min")||1,r=t.attr("data-max"),o=t.find(".decrement"),s=t.find(".increment");if(e=parseInt(e,10),n>=e)e=n,o.addClass("disabled");if(e>=r)!i&&(e=r),s.addClass("disabled");if(e>n&&r>e)o.removeClass("disabled"),s.removeClass("disabled");return t.find(".num").val(e),e},resetItemInfo:function(e,t){e.attr("data-max",t),this.checkNum(e.attr("data-num"),e,1)},numReset:function(e){this.checkNum(e.attr("data-num"),e,1)},delCart:function(t,i){var n=this;e.post("/cart/delPreview",{skuIds:i}).then(function(e){switch(e.code){case 200:t.remove(),n.renderCart(e.result),trackEventTJ(4,[{skuId:i}])}},function(){})},getCartInfo:function(){var t=this,i=$("#header .bag-wrap"),n=i.find(".bag-empty");if(i.hasClass("loading"))return!1;else return n.length&&(n.remove(),i.append('<div class="bag-inner"><div class="loading-wrap">正在加载中<span class="dotting"></span></div></div>')),i.addClass("loading"),void e.fetch("/cart/preview").then(function(e){switch(e.code){case 200:e=e.result,t.renderCart(e);break;default:t.renderCart({errorStatus:1})}},function(){t.renderCart({errorStatus:1})}).always(function(){i.removeClass("loading")})},getMinCartInfo:function(t){e.fetch("/cart/preview").then(function(e){switch(e.code){case 200:e=e.result,$(t).text(e.totalNum)}},function(){})},getMinUserInfo:function(e){var t=$(e),i=encodeURIComponent(window.location.protocol+"//"+window.location.host+"/login");n.on("login",function(n){var r='<a href="/home" target="_blank"  data-position-id="1000003">您好，'+n.displayName+'</a><span class="separate">|</span><a href="http://passport.baidu.com/?logout&u='+i+'" data-position-id="1000004">退出</a>';if(".common-login-info"===e)r+='<span class="separate">|</span>';t.empty().append(r)}).init()},bindMinHeader:function(){var e=this,t="https://"+GLOBAL_CONF.passport.host+"/v2/?reg&tpl="+GLOBAL_CONF.passport.tpl+"&u="+encodeURIComponent(location.href);$(document).on("click",".J_loginBtn",function(){n.tryLogin().then(function(){window.location.reload()})}),$(document).on("mouseenter",".J_talk",function(){e.createTip($(this))}).on("mouseleave",".J_talk",function(){$(".talk-tip").remove()}),$(".J_regBtn").length&&$(".J_regBtn").attr("href",t)},bindTalk:function(){var e=this;$(document).on("click",".J_talk",function(t){var i=$(this).attr("data-siteid"),n=$(this).attr("data-ucid");e.openTalk(i,n,$(this))})},createTip:function(e){var t=e.offset(),i=t.top,n=t.left,r=e.height(),o=$('<div class="talk-tip">点击可直接与品牌商家沟通，咨询商品信息哦</div>');$("body").append(o),o.css({top:i+r,left:n})},openTalk:function(e,t,i){var n="http://p.qiao.baidu.com/im/index?siteid="+e+"&ucid="+t,r=$(window).width(),o=$(window).height(),s=(r-796)/2,a=(o-562)/2,l="width=795, height=561, top="+a+", left="+s+", toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no",c=this.talkInfo[t];if(c&&!c.closed)c.focus();else c=window.open(n,"talk"+e,l),this.talkInfo[t]=c},updateCart:function(t,i){var n=this,r=t,o=r.attr("data-shopid"),s=r.attr("data-type"),a=r.attr("data-id");t.addClass("loading"),e.post("/cart/updatePreview",{skuId:a,skuNum:i,skuType:s,shopId:o}).then(function(e){switch(e.code){case 200:n.renderCart(e.result),trackEventTJ(5,[{skuId:a},{skuNum:i},{skuType:s}]);break;case 10002:n.resetItemInfo(r,e.result.num);break;default:n.numReset(t)}},function(){n.numReset(t)}).always(function(){t.removeClass("loading")})},renderCart:function(e){var n=t.compile(i),r=$("#header .bag-wrap"),o=$(n(e));$("#header .total-num").text(e.totalNum),r.find(".bag-inner").remove().end().append(o)},bindMenu:function(){var e,t,i="hover ",o="visited ";$("#common-header").on("mouseenter",".sub-menu-item",function(){var n=this;clearTimeout(e),clearTimeout(t),e=setTimeout(function(){$(n).removeClass(o).addClass(i).siblings().removeClass(i+o)},70)}).on("mouseleave",".sub-menu-item",function(){var e=this;clearTimeout(t),t=setTimeout(function(){$(e).removeClass(i).siblings().removeClass(o)},200)}).on("click",".login",function(e){return n.tryLogin(),!1}).on("click","#logout",function(e){r.remove("mi"),r.remove("mi",{domain:".mall.baidu.com"}),r.remove("ms"),r.remove("ms",{domain:".mall.baidu.com"}),location.href="http://passport.baidu.com/?logout&u="+encodeURIComponent(location.href)}).on("click",".register",function(e){n.gotoRegisterPage()}).on("mouseenter",".all-category",function(){trackEventTJ(10)}),$("#footer .register").on("click",function(){n.gotoRegisterPage()}),$("#common-header .sub-menu-item").first().trigger("mouseleave")},generateTongjiLinks:function(){$(document).on("click","a,area",function(e){var t=$(this).attr("href");if(void 0!==t&&"string"==typeof t)if(t.length>0&&("/"===t[0]||-1!==t.indexOf("mall.baidu.com"))&&-1===t.indexOf("javascript")){e.preventDefault();var i=$(this).attr("target"),n=~~$(this).data("position-id");if("_blank"===i)window.open(generateTongjiURL(t,n));else window.location.href=generateTongjiURL(t,n)}})},getUserInfo:function(){function e(e){if(e)t.addClass("active").find(".username").text(e.displayName);else t.removeClass("active")}var t=$("#common-header .user-command");n.on("login",e).init()}};return s});