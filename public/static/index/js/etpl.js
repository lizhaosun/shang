/*! 2016 Baidu Inc. All Rights Reserved */
!function(t){function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function i(){this.raw=[],this.length=0}function n(){return"___"+A++}function o(t,e){var i=new Function;i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}function r(t){return L[t]}function s(t){return'"'+t.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function a(t){return t.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(t){return"\\"+t})}function l(t){var e=arguments;return t.replace(/\{([0-9]+)\}/g,function(t,i){return e[i-0+1]})}function h(t){return t=t.replace(/^\s*\*/,""),l('gv({0},["{1}"])',s(t),t.replace(/\[['"]?([^'"]+)['"]?\]/g,function(t,e){return"."+e}).split(".").join('","'))}function c(t,e,i,n,o,r){for(var s=i.length,a=t.split(e),l=0,h=[],c=0,u=a.length;u>c;c++){var d=a[c];if(c){var f=1;for(l++;;){var p=d.indexOf(i);if(0>p){h.push(l>1&&f?e:"",d);break}if(l=n?l-1:0,h.push(l>0&&f?e:"",d.slice(0,p),l>0?i:""),d=d.slice(p+s),f=0,0===l)break}0===l&&(o(h.join("")),r(d),h=[])}else d&&r(d)}l>0&&h.length>0&&(r(e),r(h.join("")))}function u(t,e,i){var n,o=[],r=e.options,a="",l="",d="",f="";return i&&(a="ts(",l=")",d=I,f=D,n=r.defaultFilter),c(t,r.variableOpen,r.variableClose,1,function(t){i&&t.indexOf("|")<0&&n&&(t+="|"+n);var r=t.indexOf("|"),s=(r>0?t.slice(0,r):t).replace(/^\s+/,"").replace(/\s+$/,""),c=r>0?t.slice(r+1):"",p=0===s.indexOf("*"),g=[p?"":a,h(s),p?"":l];if(c){c=u(c,e);for(var m=c.split("|"),v=0,y=m.length;y>v;v++){var _=m[v];/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(_)&&(g.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3&&g.push(",",RegExp.$3),g.push(")"))}}o.push(d,g.join(""),f)},function(t){o.push(d,i?s(t):t,f)}),o.join("")}function d(t,e){this.value=t,this.engine=e}function f(t,e){this.value=t,this.engine=e,this.children=[],this.cloneProps=[]}function p(t,e){var i=t.stack,n=e?i.find(function(t){return t instanceof e}):i.bottom();if(n){for(var o;(o=i.top())!==n;){if(!o.autoClose)throw new Error(o.type+" must be closed manually: "+o.value);o.autoClose(t)}n.close(t)}return n}function g(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.master=RegExp.$3,this.name=RegExp.$1,f.call(this,t,e),this.blocks={}}function m(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,f.call(this,t,e),this.cloneProps=["name"]}function v(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,f.call(this,t,e),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(t,e){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.expr=RegExp.$2,f.call(this,t,e),this.cloneProps=["name","expr"]}function _(t,e){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.args=RegExp.$3,f.call(this,t,e),this.cloneProps=["name","args"]}function x(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.args=RegExp.$3,f.call(this,t,e),this.cloneProps=["name","args"]}function b(t,e){var i=new RegExp(l("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",a(e.options.variableOpen),a(e.options.variableClose)),"i");if(!i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,f.call(this,t,e),this.cloneProps=["list","item","index"]}function w(t,e){f.call(this,t,e)}function T(t,e){w.call(this,t,e)}function C(t,e){f.call(this,t,e)}function S(t,e){e.target=t;var i=e.engine,n=t.name;if(i.targets[n])switch(i.options.namingConflict){case"override":i.targets[n]=t,e.targets.push(n);case"ignore":break;default:throw new Error("Target exists: "+n)}else i.targets[n]=t,e.targets.push(n)}function E(t,e){R[t]=e,e.prototype.type=t}function k(t){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(t),this.targets={},this.filters=e({},M)}function z(t,e){function n(){var t;if(u.length>0&&(t=u.join(""))){var i=new d(t,e);i.beforeAdd(h),l.top().addChild(i),u=[],e.options.strip&&h.current instanceof f&&(i.value=t.replace(/^[\x20\t\r]*\n/,"")),h.current=i}}var o,r=e.options.commandOpen,s=e.options.commandClose,a=e.options.commandSyntax,l=new i,h={engine:e,targets:[],stack:l,target:null},u=[];return c(t,r,s,0,function(t){var i=a.exec(t);if(i&&(o=R[i[2].toLowerCase()])&&"function"==typeof o){n();var l=h.current;e.options.strip&&l instanceof d&&(l.value=l.value.replace(/\r?\n[\x20\t]*$/,"\n")),i[1]?l=p(h,o):(l=new o(i[3],e),"function"==typeof l.beforeOpen&&l.beforeOpen(h),l.open(h)),h.current=l}else/^\s*\/\//.test(t)||u.push(r,t,s);o=null},function(t){u.push(t)}),n(),p(h),h.targets}i.prototype={push:function(t){this.raw[this.length++]=t},pop:function(){if(this.length>0){var t=this.raw[--this.length];return this.raw.length=this.length,t}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(t){for(var e=this.length;e--;){var i=this.raw[e];if(t(i))return i}}};var A=178245,L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},M={html:function(t){return t.replace(/[&<>"']/g,r)},url:encodeURIComponent,raw:function(t){return t}},$='var r="";',I="r+=",D=";",O="return r;";"undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8&&($="var r=[],ri=0;",I="r[ri++]=",O='return r.join("");'),d.prototype={getRendererBody:function(){var t=this.value,e=this.engine.options;return!t||e.strip&&/^\s*$/.test(t)?"":u(t,this.engine,1)},clone:function(){return this}},f.prototype={addChild:function(t){this.children.push(t)},open:function(t){var e=t.stack.top();e&&e.addChild(this),t.stack.push(this)},close:function(t){t.stack.top()===this&&t.stack.pop()},getRendererBody:function(){for(var t=[],e=this.children,i=0;i<e.length;i++)t.push(e[i].getRendererBody());return t.join("")},clone:function(){for(var t=new this.constructor(this.value,this.engine),e=0,i=this.children.length;i>e;e++)t.addChild(this.children[e].clone());for(var e=0,i=this.cloneProps.length;i>e;e++){var n=this.cloneProps[e];t[n]=this[n]}return t}};var P='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';o(g,f),o(m,f),o(v,f),o(y,f),o(_,f),o(x,f),o(b,f),o(w,f),o(T,w),o(C,w);var N={READING:1,READED:2,APPLIED:3,READY:4};v.prototype.applyMaster=g.prototype.applyMaster=function(t){function e(t){var n=t.children;if(n instanceof Array)for(var o=0,r=n.length;r>o;o++){var s=n[o];s instanceof m&&i[s.name]&&(s=n[o]=i[s.name]),e(s)}}if(this.state>=N.APPLIED)return 1;var i=this.blocks,n=this.engine.targets[t];return n&&n.applyMaster(n.master)?(this.children=n.clone().children,e(this),this.state=N.APPLIED,1):void 0},g.prototype.isReady=function(){function t(n){for(var o=0,r=n.children.length;r>o;o++){var s=n.children[o];if(s instanceof v){var a=e.targets[s.name];i=i&&a&&a.isReady(e)}else s instanceof f&&t(s)}}if(this.state>=N.READY)return 1;var e=this.engine,i=1;return this.applyMaster(this.master)?(t(this),i&&(this.state=N.READY),i):void 0},g.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var t=new Function("data","engine",[P,$,this.getRendererBody(),O].join("\n")),e=this.engine;return this.renderer=function(i){return t(i,e)},this.renderer}return null},g.prototype.open=function(t){p(t),f.prototype.open.call(this,t),this.state=N.READING,S(this,t)},y.prototype.open=x.prototype.open=function(t){t.stack.top().addChild(this)},m.prototype.open=function(t){f.prototype.open.call(this,t),(t.imp||t.target).blocks[this.name]=this},T.prototype.open=function(t){var e=new C;e.open(t);var i=p(t,w);i.addChild(this),t.stack.push(this)},C.prototype.open=function(t){var e=p(t,w);e.addChild(this),t.stack.push(this)},v.prototype.open=function(t){this.parent=t.stack.top(),this.target=t.target,f.prototype.open.call(this,t),this.state=N.READING,t.imp=this},x.prototype.close=y.prototype.close=function(){},v.prototype.close=function(t){f.prototype.close.call(this,t),this.state=N.READED,t.imp=null},g.prototype.close=function(t){f.prototype.close.call(this,t),this.state=this.master?N.READED:N.APPLIED,t.target=null},v.prototype.autoClose=function(t){var e=this.parent.children;e.push.apply(e,this.children),this.children.length=0;for(var i in this.blocks)this.target.blocks[i]=this.blocks[i];this.blocks={},this.close(t)},x.prototype.beforeOpen=v.prototype.beforeOpen=y.prototype.beforeOpen=b.prototype.beforeOpen=_.prototype.beforeOpen=m.prototype.beforeOpen=w.prototype.beforeOpen=d.prototype.beforeAdd=function(t){if(!t.stack.bottom()){var e=new g(n(),t.engine);e.open(t)}},v.prototype.getRendererBody=function(){return this.applyMaster(this.name),f.prototype.getRendererBody.call(this)},x.prototype.getRendererBody=function(){return l("{0}engine.render({2},{{3}}){1}",I,D,s(this.name),u(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(t,e,i){return(e||"")+s(i)+":"}))},y.prototype.getRendererBody=function(){return this.expr?l("v[{0}]={1};",s(this.name),u(this.expr,this.engine)):""},w.prototype.getRendererBody=function(){return l("if({0}){{1}}",u(this.value,this.engine),f.prototype.getRendererBody.call(this))},C.prototype.getRendererBody=function(){return l("}else{{0}",f.prototype.getRendererBody.call(this))},b.prototype.getRendererBody=function(){return l('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',n(),u(this.list,this.engine),s(this.index||n()),s(this.item),n(),n(),f.prototype.getRendererBody.call(this))},_.prototype.getRendererBody=function(){var t=this.args;return l("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",$,O,I,D,f.prototype.getRendererBody.call(this),s(this.name),t?","+u(t,this.engine):"")};var R={};E("target",g),E("block",m),E("import",v),E("use",x),E("var",y),E("for",b),E("if",w),E("elif",T),E("else",C),E("filter",_),k.prototype.config=function(t){e(this.options,t)},k.prototype.compile=k.prototype.parse=function(t){if(t){var e=z(t,this);if(e.length)return this.targets[e[0]].getRenderer()}return new Function('return ""')},k.prototype.getRenderer=function(t){var e=this.targets[t];return e?e.getRenderer():void 0},k.prototype.render=function(t,e){var i=this.getRenderer(t);return i?i(e):""},k.prototype.addFilter=function(t,e){"function"==typeof e&&(this.filters[t]=e)};var B=new k;B.Engine=k,"object"==typeof exports&&"object"==typeof module?exports=module.exports=B:"function"==typeof define&&define.amd?define("common/etpl",[],B):t.etpl=B}(this);